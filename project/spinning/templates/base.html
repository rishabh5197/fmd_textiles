<!doctype html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{% block title %}Actions ¬∑ Dashboard{% endblock %}</title>
  <meta name="color-scheme" content="light dark" />
  <link rel="stylesheet" href="{{ url_for('spinning.static', filename='main.css') }}">
  <link rel="stylesheet" href="{{ url_for('spinning.static', filename='add_fibers_and_bales.css') }}">
  <script defer src="{{ url_for('spinning.static', filename='app.js') }}"></script>
</head>
<body>
  <div class="container">
    <nav class="nav" aria-label="Primary">
      <div class="brand" aria-label="Brand">
        <div class="logo" aria-hidden="true"></div>
        <span>Fire Mount Denim</span>
      </div>
      <div class="nav-actions">
        <button class="btn ghost" id="toggleTheme" aria-pressed="false" title="Toggle theme"> ‚òÄÔ∏è Light Theme</button>
      </div>
    </nav>

    {% block content %}{% endblock %}
  </div>

  <!-- Modal: Create / Update -->
  <div class="modal-backdrop" id="modalBackdrop" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal" role="document">
      <div style="display:flex; align-items:center; gap:8px">
        <h3 id="modalTitle">Create Action</h3>
        <button class="close-x" id="closeModal" aria-label="Close">&times;</button>
      </div>
      <form id="actionForm">
        <input type="hidden" id="actionId" />
        <div class="field">
          <label for="title">Title <span class="sr-only">(required)</span></label>
          <input id="title" name="title" placeholder="e.g. Prepare release notes" required />
        </div>
        <div class="field">
          <label for="description">Description</label>
          <textarea id="description" name="description" rows="4" placeholder="Add more details‚Ä¶"></textarea>
        </div>
        <div class="field">
          <label for="status">Status</label>
          <select id="status" name="status">
            <option value="pending">Pending</option>
            <option value="in-progress">In progress</option>
            <option value="done">Done</option>
          </select>
        </div>
        <div class="row">
          <button type="button" class="btn ghost" id="cancelModal">Cancel</button>
          <button type="submit" class="btn" id="submitBtn">Save</button>
        </div>
      </form>
    </div>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

<script>
    (function () {
      const root = document.documentElement;
      const btn = document.getElementById('toggleTheme');

      function applyTheme(theme, source = 'user') {
        root.setAttribute('data-theme', theme);
        root.setAttribute('data-theme-source', source);
        try { localStorage.setItem('theme', theme); } catch (_) {}
        if (btn) {
          btn.setAttribute('aria-pressed', String(theme !== 'light'));
          btn.textContent = theme === 'light' ?"üåô Dark Theme" : "‚òÄÔ∏è Light Theme" ; // update button label
        }
      }

      function initTheme() {
        let theme;
        try {
          theme = localStorage.getItem('theme');
        } catch (_) {}
        if (!theme) {
          const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
          theme = prefersDark ? 'dark' : 'light';
          applyTheme(theme, 'system');
        } else {
          applyTheme(theme);
        }
      }

      function toggleTheme() {
        const isLight = root.getAttribute('data-theme') === 'light';
        applyTheme(isLight ? 'dark' : 'light');
      }

      initTheme();

      if (btn) {
        btn.addEventListener('click', toggleTheme);
        btn.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); toggleTheme(); }
        });
      }

      window.addEventListener('storage', (e) => {
        if (e.key === 'theme' && e.newValue) {
          applyTheme(e.newValue);
        }
      });
    })();
</script>
</body>
</html>
